try{!function(){"use strict";var e=function(){function e(){function e(e,t){return t?n.randomBaseUrl+"/interaction/random/v2/"+e:n.playerBaseUrl+"/interaction/"+e}function t(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}var n=i.getInstance();return{onDocumentReady:function(e){return"complete"===document.readyState?e():(document.addEventListener("DOMContentLoaded",e,!1),void window.addEventListener("load",e,!1))},buildInteractionIframe:function(t,n){var i=document.createElement("iframe");return i.src=e(t,n),i["class"]="qmerce-interaction",i.setAttribute("data-interaction-id",t),i.setAttribute("from-sdk",""),i.scrolling="no",i.frameBorder=0,i.width="100%",i.height=0,i.style.maxWidth="600px",i.style.margin="0 auto",document.body.clientWidth<600&&(i.height=400),i},setElementStyle:function(e){e.style.width="100%",e.style.maxWidth="600px",e.style.margin="0 auto",e.style.display="block",e.style.position="relative",e.style.minHeight="350px"},buildGif:function(e,t){var n=document.createElement("div"),i=document.createElement("img");return n.id="ape_wrapper_"+e,n.style.height="100%",n.style.width="100%",n.style.position="absolute",n.style.backgroundColor="white",i.className="ape_img_"+e,i.src=t,i.style.height="100px",i.style.width="100px",i.style.display="block",i.style.top="50%",i.style.left="50%",i.style.position="absolute",i.style.transform="translate(-50%,-50%)",i.style["margin-top"]="-22px",n.appendChild(i),n},isMobileDevice:t(),isElementInViewport:function(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect(),n=window.innerHeight-t.top,i=t.top>=0?n>=30:t.bottom>=30;return t.bottom>=0&&t.right>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.left<=(window.innerWidth||document.documentElement.clientWidth)&&i},onVisibilityChange:function(e,t){return function(){var n=this.isElementInViewport(e);n&&"function"==typeof t&&n&&t(e)}.bind(this)}}}var t;return{getInstance:function(){return t||(t=e()),t}}}(),t=function(t){this.containerElement=t,this.config=i.getInstance(),this.utils=e.getInstance(),this.isRandom=!!this.containerElement.dataset.random,this.interactionIDOrToken=this.isRandom?this.containerElement.dataset.random:this.containerElement.id,this.interaction={}};t.prototype={setChainOfResponsibility:function(){this.createLoader().createIframe().setListeners()},display:function(){if(this.isRandom){var e=new XMLHttpRequest;e.onreadystatechange=function(t){e.response&&4===e.readyState&&JSON.parse(e.response).payload&&200===e.status&&(this.interaction=JSON.parse(e.response).payload,this.setChainOfResponsibility())}.ApesterBind(this),this.interactionIDOrToken&&(e.open("GET",this.config.displayBaseUrl+"/tokens/"+this.interactionIDOrToken+"/interactions/random",!0),e.send(null))}else{var e=new XMLHttpRequest;e.onreadystatechange=function(t){e.response&&4===e.readyState&&JSON.parse(e.response).payload&&200===e.status&&(this.interaction=JSON.parse(e.response).payload,this.setChainOfResponsibility())}.ApesterBind(this),this.interactionIDOrToken&&(e.open("GET",this.config.displayBaseUrl+"/interactions/"+this.interactionIDOrToken+"/display",!0),e.send(null))}return this},createLoader:function(){var e=this.containerElement;return this.utils.setElementStyle(e),this.utils.isMobileDevice||e.appendChild(this.utils.buildGif(this.interactionIDOrToken,this.config.GIF_URL)),this},createIframe:function(){return this.containerElement.appendChild(this.utils.buildInteractionIframe(this.interactionIDOrToken,this.isRandom)),this},setListeners:function(){var e=this.utils.onVisibilityChange(this.containerElement,function(t){var n=t.id||t.dataset.random;n===this.interaction.interactionId&&(t.querySelector("iframe").contentWindow.postMessage("interaction seen","*"),this.removeEventListenersFromViewport(e))}.ApesterBind(this));return this.addEventListenersToViewport(e),setTimeout(function(){postMessage({timeout:!0,interactionId:this.interactionIDOrToken},location.origin)}.ApesterBind(this),5e3),this},addEventListenersToViewport:function(e){var t,n=this.config.events;if(window.addEventListener)for(t=0;t<n.length;t++)addEventListener(n[t],e,!1);else if(window.attachEvent)for(t=0;t<n.length;t++)attachEvent(n[t],e)},removeEventListenersFromViewport:function(e){var t,n=this.config.events;if(window.addEventListener)for(t=0;t<n.length;t++)removeEventListener(n[t],e,!1);else if(window.attachEvent)for(t=0;t<n.length;t++)detachEvent(n[t],e)}};var n=function(){function e(){var e=!0;return e}function t(){for(var e=document.getElementsByTagName("meta"),t=0;t<e.length;t++)n(e[t]);for(var a=document.getElementsByTagName("link"),t=0;t<a.length;t++)i(a[t]);if(document.title&&"undefined"!=typeof document.title&&(s.title=document.title),"undefined"==typeof s.url){var o=document.location.href;s.url=o}if("undefined"==typeof s.locale){var r=document.documentElement.lang;s.locale=r}}function n(e){var t=e.getAttribute("property"),n=e.getAttribute("content"),i=e.getAttribute("name");if(n&&"undefined"!=typeof n){switch(t){case"twitter:url":case"twitter:title":case"twitter:image":var a=t.split(":");"undefined"==typeof s[a[1]]&&(s[a[1]]=n);break;case"og:locale":case"og:description":case"article:tag":case"article:published_time":case"article:modified_time":case"article:expiration_time":case"article:author":case"article:section":case"og:title":case"og:image":case"og:url":s[t.split(":")[1]]=n}switch(i){case"viewport":break;case"keywords":s.tag=s.tag+" "+n;break;default:s[i]=n}}return s}function i(e){var t=(e.getAttribute("rel"),e.getAttribute("content"));if(t&&"undefined"!=typeof t){switch(e){case"image_src":s.image=e.getAttribute("content");break;case"canonical":s.url=e.getAttribute("content")}return s}}function a(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length-1;t++){if(/apester-sdk/.test(e[t].src))return!0;if(/qmerce-sdk/.test(e[t].src))return!0}return!1}function o(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length-1;t++){if(/apester-embedded/.test(e[t].src))return!0;if(/http:\/\/stage3-embed\.apester\.com/.test(e[t].src))return!0}return!1}function r(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}var s={},c=[];return{apesterEmbeddedPresent:o(),apesterSDKPresent:a(),collect:function(){return e()&&t(),s},findInteractionTags:function(){return c=Array.prototype.slice.call(document.getElementsByTagName("interaction"),0)},getScriptParent:function(){var e=document.getElementsByTagName("script");e=e[e.length-1];var t=e.parentNode,n=[t];return r(t,"ape-interaction")||(n=[],console.error("ApesterEmbedded parent element must have 'ape-interaction' class.")),n},collectInteractionData:function(e){function t(e){return{answer:e.answer,id:e.id,options:e.options,title:e.title}}for(var n=[],i=0;i<e.data.slides.length;i+=1)n.push(t(e.data.slides[i]));var a="";return e.publishingOptions&&e.publishingOptions.endDate&&(a=e.publishingOptions.endDate),{created:e.created,interactionId:e.interactionId,language:e.language,layout:e.layout.name,publisherId:e.publisherId,title:e.title,updated:e.updated,tags:e.tags||[],expires:a,sessionId:e.sessionId}}}}(),i=function(){function e(){function e(e,t,n){var t="b",n="jpg",i="farm{farm-id}.staticflickr.com%2f{server-id}%2f{id}_{secret}_{size}.{format}".replace("{farm-id}",e.farm).replace("{server-id}",e.server).replace("{id}",e.id).replace("{secret}",e.secret).replace("{size}",t).replace("{format}",n);return"//images.apester.com/ext_ssl/"+i}function t(e){return"//img.youtube.com/vi/"+e+"/hqdefault.jpg"}return{GIF_URL:"https://images.apester.com/images%2Floader.gif",playerBaseUrl:window.location.protocol+"//renderer.qmerce.com",randomBaseUrl:window.location.protocol+"//random.qmerce.com",displayBaseUrl:window.location.protocol+"//display.apester.com",cdn_url:"//images.apester.com/",eventCollectorUrl:window.location.protocol+"//events.apester.com/event",youtube_video_thumb:function(e){t(e)},flickr_thumb:function(t){return e(t)},events:["DOMContentLoaded","load","scroll","resize"]}}var t;return{getInstance:function(){return t||(t=e()),t}}}();(function(){function e(){if(w=v.findInteractionTags(),!T){T=!0;for(var e=0;e<w.length;e++){var n=new t(w[e]);k.push(n),n.display()}o(),a(),r()}}function a(){var e=I,t={destinationLanguage:e.locale,destinationTitle:e.title,destinationDescription:e.description,destinationContext:e.tag,destinationPreview:e.image,destinationPublishDate:e.published_time,destinationUpdateDate:e.modified_time,destinationExpirationDate:e.expiration_time,destinationAuthor:e.author,destinationSection:e.section},n={destinationUri:e.url};I={event:"recommendation_collected",properties:n,metadata:t}}function o(){I=v.collect()}function r(){k.length>0?window.addEventListener("message",d):v.apesterEmbeddedPresent?console.log("ApesterSDK sleeps, ApesterEmbedded is here!"):s()}function s(){try{var e=new XMLHttpRequest;e.onreadystatechange=function(t){e.response&&4===e.readyState&&200===e.status&&(E=!0,console.log(e.response))},I&&!E&&(e.open("POST",b.eventCollectorUrl,!0),e.setRequestHeader("Content-Type","application/json;charset=UTF-8"),e.send(JSON.stringify(I)),console.log("SDK DATA PAYLOAD",I))}catch(t){console.error("Send data to "+b.eventCollectorUrl+" failed: ",t)}}function c(e){for(var t=w,n=0;n<t.length;n+=1){var i=t[n];if(i.id===e)return t.splice(n,1)[0]}for(var n=0;n<t.length;n+=1){var i=t[n];if(i.dataset.random)return t.splice(n,1)[0]}}function d(e){if(e.origin.search("qmerce|apester|localhost")>-1){if(e.data.interaction){var t=e.data.interaction,n={};n.interactionId=t.interactionId,n.width=(t.data.size||{}).width||600,n.height=(t.data.size||{}).height>0?(t.data.size||{}).height-40:338,"contest-poll"===t.layout.directive&&(n.height+=40);var i=c(e.data.interaction.interactionId);i&&(m(n,i),u(t),p(I),s(),y(i))}if(e.data.timeout){var a=e.data.interactionId,i=c(a);if(i){var n={};n.interactionId=a,n.width=0,n.height=0,m(n,i),l(i)}}}}function l(e){setTimeout(function(){e.style.display="none"},3100)}function p(e){for(var t in e)null===e[t]||"undefined"==typeof e[t]||0==e[t].length?delete e[t]:"object"==typeof e[t]&&p(e[t])}function u(e){var t=v.collectInteractionData(e),n=I;n.metadata.mediaChannelId=t.publisherId,n.metadata.mediaUserId=t.userId,n.metadata.mediaTitle=t.title,n.metadata.mediaTags=t.tag,n.metadata.mediaCreationDate=t.created,n.metadata.mediaContext=t.slides,n.metadata.mediaUpdateDate=t.updated,n.metadata.mediaExpirationDate=t.expires,n.metadata.mediaLanguage=t.language,n.properties.interactionId=t.interactionId,n.sessionId=t.sessionId}function m(e,t){try{var n=t.getElementsByTagName("iframe")[0],i=t.id||t.dataset.random;t.dataset.random&&(n.dataset.interactionId=e.interactionId),f(i,e.height,t),g(i,t),n.height=e.height}catch(a){return void console.error("onIframeMessage error: ",a)}}function h(e){return"complete"===document.readyState?e():(document.addEventListener("DOMContentLoaded",e,!1),void window.addEventListener("load",e,!1))}function f(e,t,n){var i=n.querySelector(".ape_wrapper_"+e);i&&(i.style.height=t+"px")}function g(e,t){var n=3,i=t.querySelector(".ape_img_"+e);i&&setTimeout(function(){i.parentNode.style.transition="opacity "+n+"s ease-in-out",i.parentNode.style["-webkit-transition"]="opacity "+n+"s ease-in-out",i.parentNode.style["-moz-transition"]="opacity "+n+"s ease-in-out",i.parentNode.style.opacity=0,setTimeout(function(){i.parentNode.parentNode.removeChild(i.parentNode)},1e3*n)},100)}function y(e){var t=e.getElementsByTagName("iframe")[0];t.contentWindow.postMessage("apester-sdk","*")}var v=n,w=[],b=i.getInstance(),k=[],I={},E=!1,T=!1;return Function.prototype.ApesterBind=function(){return Function.prototype.bind?Function.prototype.bind:function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var t=Array.prototype.slice.call(arguments,1),n=this,i=function(){},a=function(){return n.apply(this instanceof i?this:e,t.concat(Array.prototype.slice.call(arguments)))};return this.prototype&&(i.prototype=this.prototype),a.prototype=new i,a}}(),v.apesterSDKPresent?console.error("ApesterSDK already loaded, make sure to include it only once!"):h(e),{render:e,messagesHandler:d}})()}()}catch(e){var xmlHttp=new XMLHttpRequest;xmlHttp.open("POST","https://events.apester.com/event",!0),xmlHttp.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xmlHttp.send(JSON.stringify({event:"apester-sdk-crashed",properties:{destinationUri:document.location.href},metadata:{userAgent:navigator.userAgent}})),console.error("ApesterSDK had critical error, please contact us with the following error message: ",e)}
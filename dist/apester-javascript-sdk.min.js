try{!function(){"use strict";var e=function(){function e(){for(var e=document.getElementsByTagName("meta"),i=0;i<e.length;i++)t(e[i]);for(var a=document.getElementsByTagName("link"),i=0;i<a.length;i++)n(a[i]);if(document.title&&"undefined"!=typeof document.title&&(d.title=document.title),"undefined"==typeof d.url){var r=document.location.href;d.url=r}if("undefined"==typeof d.locale){var o=document.documentElement.lang;d.locale=o}}function t(e){var t=e.getAttribute("property"),n=e.getAttribute("content"),i=e.getAttribute("name");if(n&&"undefined"!=typeof n){switch(t){case"twitter:url":case"twitter:title":case"twitter:image":var a=t.split(":");"undefined"==typeof d[a[1]]&&(d[a[1]]=n);break;case"og:locale":case"og:description":case"article:tag":case"article:published_time":case"article:modified_time":case"article:expiration_time":case"article:author":case"article:section":case"og:title":case"og:image":case"og:url":d[t.split(":")[1]]=n}switch(i){case"viewport":break;case"keywords":d.tag=d.tag+" "+n;break;default:d[i]=n}}return d}function n(e){var t=e.getAttribute("rel"),n=e.getAttribute("href");if(n&&"undefined"!=typeof n){switch(t){case"image_src":d.image=n;break;case"canonical":d.url=n}return d}}function i(){}function r(){for(var e=document.getElementsByTagName("script"),t=0;t<e.length-1;t++){if(/apester-embedded/.test(e[t].src))return!0;if(/http:\/\/stage3-embed\.apester\.com/.test(e[t].src))return!0}return!1}function o(e,t){return(" "+e.className+" ").indexOf(" "+t+" ")>-1}function s(){for(var e=[],t=0;t<u.supportedTags.length;t++){var n=u.supportedTags[t];e=e.concat(Array.prototype.slice.call(document.getElementsByTagName(n)))}return e}function c(){for(var e=[],t=0;t<u.supportedClasses.length;t++){var n=u.supportedClasses[t];e=e.concat(Array.prototype.slice.call(document.getElementsByClassName(n)))}return e}var d={},l=[],u=a.getInstance();return{apesterEmbeddedPresent:r(),apesterSDKPresent:i(),collect:function(){return e(),d},getInteractionElements:function(){var e=s();return e.concat(c())},findInjectionPoint:function(e){return l=document.querySelector(e)},getScriptParent:function(){var e=document.getElementsByTagName("script");e=e[e.length-1];var t=e.parentNode,n=[t];return o(t,"ape-interaction")||(n=[],console.error("ApesterEmbedded parent element must have 'ape-interaction' class.")),n},collectInteractionData:function(e){function t(e){return{answer:e.answer,id:e.id,options:e.options,title:e.title}}for(var n=[],i=0;i<e.data.slides.length;i+=1)n.push(t(e.data.slides[i]));var a="";return e.publishingOptions&&e.publishingOptions.endDate&&(a=e.publishingOptions.endDate),{created:e.created,interactionId:e.interactionId,language:e.language,layout:e.layout.name,publisherId:e.publisherId,title:e.title,updated:e.updated,tags:e.tags||[],expires:a,sessionId:e.sessionId}}}},t=function(){function e(){function e(e){return s.playerBaseUrl+"/interaction/"+e+"?sdk="+s.VERSION+s.TYPE}function t(){var e=!1;return function(t){(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino|android|ipad|playbook|silk/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4)))&&(e=!0)}(navigator.userAgent||navigator.vendor||window.opera),e}function n(e){"function"==typeof jQuery&&e instanceof jQuery&&(e=e[0]);var t=e.getBoundingClientRect(),n=window.innerHeight-t.top,i=t.top>=0?n>=30:t.bottom>=30;return t.bottom>=0&&t.right>=0&&t.top<=(window.innerHeight||document.documentElement.clientHeight)&&t.left<=(window.innerWidth||document.documentElement.clientWidth)&&i}function i(e,t){return function(){var i=n(e);i&&"function"==typeof t&&i&&t(e)}}function r(e){var t,n=s.events;if(window.addEventListener)for(t=0;t<n.length;t++)addEventListener(n[t],e,!1);else if(window.attachEvent)for(t=0;t<n.length;t++)attachEvent(n[t],e)}function o(e){var t,n=s.events;if(window.addEventListener)for(t=0;t<n.length;t++)removeEventListener(n[t],e,!1);else if(window.attachEvent)for(t=0;t<n.length;t++)detachEvent(n[t],e)}var s=a.getInstance();return{buildInteractionIframe:function(t){var n=document.createElement("iframe");return n.src=e(t),n["class"]="qmerce-interaction",n.setAttribute("data-interaction-id",t),n.scrolling="no",n.frameBorder=0,n.width="100%",n.height=0,n.style.maxWidth="600px",n.style.display="block",n.style.setProperty("margin","0 auto","important"),document.body.clientWidth<600&&(n.height=400),n},setElementStyle:function(e,t,n,i){e.style.width="100%",e.style.maxWidth=n+"px",e.style.margin=i+" auto",e.style.display="block",e.style.position="relative",e.style.minHeight=t+"px"},buildGif:function(e){var t=document.createElement("div"),n=document.createElement("img");return t.id="ape_wrapper_"+e,t.style.height="100%",t.style.width="100%",t.style.position="absolute",t.style.backgroundColor="white",n.className="ape_img_"+e,n.src=s.GIF_URL,n.style.height="100px",n.style.width="100px",n.style.display="block",n.style.top="50%",n.style.left="50%",n.style.position="absolute",n.style["margin-top"]="-50px",n.style["margin-left"]="-50px",n.style.setProperty("background","transparent","important"),t.appendChild(n),t},setHeight:function(e){function t(){if(e.data.updatedVersion)return e.data.updatedVersion>=7}var n=!!e.data.preResult,i=!!e.data.videoId;return(e.data.size||{}).height>0?n||i||t()?(e.data.size||{}).height||338:(e.data.size||{}).height-40:338},setViewportListeners:function(e,t){var n=i(e,function(e){t(e),o(n)});r(n),n()},cleanData:function(e){for(var t in e)null===e[t]||"undefined"==typeof e[t]||0==e[t].length?delete e[t]:"object"==typeof e[t]&&this.cleanData(e[t])},isMobileDevice:t()}}var t;return{getInstance:function(){return t||(t=e()),t}}}(),n=function(){function e(e,t,n){var i=new XMLHttpRequest;if(i.onreadystatechange=n,"withCredentials"in i)i.open(e,t,!0);else{if("undefined"==typeof XDomainRequest)throw new Error("CORS is not supported");i=new XDomainRequest,i.open(e,t)}return i}function t(e,t){return 4===e.readyState&&(200===e.status||(t(),!1))}function n(e){return JSON.parse(e)}function i(t,n,i){var a=e(t,n,null);return a.send(i),a}function a(t,n){var i=e("POST",t,null);i.setRequestHeader("Content-Type","application/json;charset=UTF-8"),i.send(JSON.stringify(n))}function r(i,a,r){function o(){var e=this;if(t(e,r)){var i=n(e.responseText);a(i)}}var s=e("GET",i,o);s.send(null)}return{send:i,sendJSON:a,fetch:r}}(),i=function(e,n){this.timer=n,this.containerElement=e,this.config=a.getInstance(),this.utils=t.getInstance(),this.channelToken=this.containerElement.dataset.random||this.containerElement.dataset.token,this.id=this.channelToken||this.containerElement.id,this.context=this.containerElement.dataset.context,this.channelId=this.containerElement.dataset.channelId};i.prototype={setChainOfResponsibility:function(){this.sendDisplayedEvent().createLoader().createIframe().setTimeout()},display:function(){if(this.context&&this.channelToken){var e=this.config.displayBaseUrl+"/tokens/"+this.id+"/contexts/"+encodeURIComponent(window.location.href)+"/interaction";n.fetch(e,function(e){this.interaction=e.payload,this.id=e.payload.interactionId,this.containerElement.id=this.id,this.setChainOfResponsibility()}.bind(this),this.displayFailedCallback.bind(this))}else if(this.channelToken){var e=this.config.displayBaseUrl+"/tokens/"+this.id+"/interactions/random";n.fetch(e,function(e){this.interaction=e.payload,this.id=e.payload.interactionId,this.containerElement.id=this.id,this.setChainOfResponsibility()}.bind(this),this.displayFailedCallback.bind(this))}else if(this.id){var e=this.config.displayBaseUrl+"/interactions/"+this.id+"/display";n.fetch(e,function(e){this.interaction=e.payload,this.setChainOfResponsibility()}.bind(this),this.displayFailedCallback.bind(this))}},displayFailedCallback:function(){var e={event:"apester-sdk-display-failed",properties:{},metadata:{language:window.navigator.userLanguage||window.navigator.language,referrer:document.location.href,screenHeight:screen.height+"",screenWidth:screen.width+""}};this.channelToken?e.properties.channelToken=this.id:e.properties.interactionId=this.id,this.utils.cleanData(e),n.sendJSON(this.config.eventCollectorUrl,e)},sendDisplayedEvent:function(){var e={event:"apester-sdk-display-ready",properties:{sdkVersion:this.config.VERSION,sdkType:this.config.TYPE,interactionId:this.interaction.interactionId,publisherId:this.interaction.publisherId,creatorId:this.interaction.userId,engine:this.interaction.layout.directive},metadata:{language:window.navigator.userLanguage||window.navigator.language,referrer:document.location.href,screenHeight:screen.height+"",screenWidth:screen.width+""}};return this.utils.cleanData(e),n.sendJSON(this.config.eventCollectorUrl,e),this},createLoader:function(){var e=this.containerElement,t=this.utils.setHeight(this.interaction),n=this.interaction.data.size.width||600,i=e.dataset.verticalMargin||0;if(this.utils.setElementStyle(e,t,n,i),!this.utils.isMobileDevice){var a=this.utils.buildGif(this.id);e.appendChild(a)}return this},createIframe:function(){var e=this.utils.buildInteractionIframe(this.id);return this.containerElement.appendChild(e),this},setTimeout:function(){function e(e){var t={timeout:!0,interactionId:e};window.postMessage(t,location.origin)}return this.timer.start(e.bind(null,this.id)),this}};var a=function(){function e(){return{GIF_URL:"https://images.apester.com/images%2Floader.gif",playerBaseUrl:window.location.protocol+"//renderer.qmerce.com",displayBaseUrl:window.location.protocol+"//display.apester.com",cdn_url:"//images.apester.com/",eventCollectorUrl:window.location.protocol+"//events.apester.com/event",TIMEOUT_DURATION:3e4,VERSION:"2.1.3",TYPE:"",events:["DOMContentLoaded","load","scroll","resize"],autoPlacementMapUrl:window.location.protocol+"//os.apester.com/prod_mapping.json",supportedTags:["apester-media","interaction"],supportedClasses:["ape-interaction","apester-media"]}}var t;return{getInstance:function(){return t||(t=e()),t}}}();window.ApesterSDK=window.ApesterSDK||function(){function o(e){e&&(A=A||e.disableEvents),c(),window.addEventListener("message",w),A||s()}function s(){var e={event:"apester-sdk-loaded",properties:{sdkVersion:L.VERSION,sdkType:L.TYPE},metadata:{language:window.navigator.userLanguage||window.navigator.language,referrer:document.location.href,screenHeight:screen.height+"",screenWidth:screen.width+""}};O.cleanData(e),n.sendJSON(L.eventCollectorUrl,e)}function c(){if(S=D.getInteractionElements(),!_){_=!0;for(var e=0;e<S.length;e++){var t=new r,n=new i(S[e],t);U.push({interaction:S[e],timer:t}),n.display()}l();try{d(p)}catch(a){console.error("Autoplacement could not run. ",a)}var o=u();C=o}}function d(e){n.fetch(L.autoPlacementMapUrl,function(t){var n=t,a=R.url;if(a){var o=a;if("/"===o.charAt(o.length-1)&&(o=o.substring(0,o.length-1)),n[a]||n[o]){var s=n[a]||n[o];if(N=D.findInjectionPoint(s.query)){var c=document.createElement("interaction");c.id=s.id,c.setAttribute("data-vertical-margin","1.7em"),N.parentNode.insertBefore(c,N.nextSibling);var d=new r,l=new i(c,d);U.push({interaction:c,timer:d}),l.display()}}}e()},function(t){console.error("Error retrieving remote placement dictionary",t),e()})}function l(){R=D.collect()}function u(){var e={destinationLanguage:R.locale,destinationTitle:R.title,destinationDescription:R.description,destinationContext:R.tag,destinationPreview:R.image,destinationPublishDate:R.published_time,destinationUpdateDate:R.modified_time,destinationExpirationDate:R.expiration_time,destinationAuthor:R.author,destinationSection:R.section},t={destinationUri:R.url},n={event:"recommendation_collected",properties:t,metadata:e};return n}function p(){U.length>0||(window.removeEventListener("message",w),D.apesterEmbeddedPresent?console.log("ApesterSDK sleeps, ApesterEmbedded is here!"):h(C))}function m(e){var t=D.collectInteractionData(e),n=JSON.parse(JSON.stringify(C));return n.metadata.mediaChannelId=t.publisherId,n.metadata.mediaUserId=t.userId,n.metadata.mediaTitle=t.title,n.metadata.mediaTags=t.tag,n.metadata.mediaCreationDate=t.created,n.metadata.mediaContext=t.slides,n.metadata.mediaUpdateDate=t.updated,n.metadata.mediaExpirationDate=t.expires,n.metadata.mediaLanguage=t.language,n.properties.interactionId=t.interactionId,n.sessionId=t.sessionId,n}function h(e){var t=new Date,i=t.getSeconds();0==i&&n.sendJSON(L.eventCollectorUrl,e)}function g(e){for(var t=0;t<U.length;t+=1){var n=U[t].interaction;if(n.id===e)return U.splice(t,1)[0]}}function f(e){var t={};t.interactionId=e.interactionId,t.width=(e.data.size||{}).width||600,t.height=O.setHeight(e);var n=g(e.interactionId);if(n){var i=(n.timer.clear(),n.interaction);k(t,i),y(i);var a=m(e);O.cleanData(a),h(a),x(i)}}function v(e){var t=g(e);if(t){var i=t.interaction,a={};a.interactionId=e,a.width=0,a.height=0,k(a,i),b(i);var r={event:"apester-sdk-timeout",properties:{sdkVersion:L.VERSION,sdkType:L.TYPE,interactionId:e},metadata:{language:window.navigator.userLanguage||window.navigator.language,referrer:document.location.href,screenHeight:screen.height+"",screenWidth:screen.width+"",currentUrl:i.src}};O.cleanData(r),n.sendJSON(L.eventCollectorUrl,r)}}function w(e){e.origin.search("qmerce|apester|localhost")>-1&&(e.data.interaction&&f(e.data.interaction),e.data.timeout&&v(e.data.interactionId))}function y(e){function t(t){var n=t.id;n===e.id&&t.querySelector("iframe").contentWindow.postMessage("interaction seen","*")}O.setViewportListeners(e,t)}function b(e){setTimeout(function(){e.style.display="none"},3100)}function k(e,t){var n=t.getElementsByTagName("iframe")[0];if(n){var i=t.id||t.dataset.random;t.dataset.random&&(n.dataset.interactionId=e.interactionId),E(i,e.height,t),T(i,t),n.height=e.height}}function I(e){return"complete"===document.readyState?e():(document.addEventListener("DOMContentLoaded",e,!1),void window.addEventListener("load",e,!1))}function E(e,t,n){var i=n.querySelector("#ape_wrapper_"+e);i&&(i.style.height=t+"px")}function T(e,t){var n=3,i=t.querySelector(".ape_img_"+e);i&&setTimeout(function(){i.parentNode.style.transition="opacity "+n+"s ease-in-out",i.parentNode.style["-webkit-transition"]="opacity "+n+"s ease-in-out",i.parentNode.style["-moz-transition"]="opacity "+n+"s ease-in-out",i.parentNode.style.opacity=0,setTimeout(function(){i.parentNode.parentNode.removeChild(i.parentNode)},1e3*n)},100)}function x(e){var t=e.getElementsByTagName("iframe")[0];t.contentWindow.postMessage("apester-sdk","*")}var C,N,D=new e,S=[],O=t.getInstance(),L=a.getInstance(),U=[],R={},_=!1,A=!1;return window.apesterLoadCallback||(window.apesterLoadCallback=function(){o()}),window.apesterLoadCallback&&!window.apesterLoadCallback.hasRun&&(window.apesterLoadCallback.hasRun=!0,I(function(){setTimeout(function(){window.apesterLoadCallback()},0)})),{Init:o}}();var r=function(){var e,t,n,i=a.getInstance().TIMEOUT_DURATION;return{start:function(n){e=setTimeout(function(){t=(new Date).getTime(),n()},i)},clear:function(){return n=(new Date).getTime(),clearTimeout(e),n-t}}}}()}catch(e){var xmlHttp=new XMLHttpRequest;xmlHttp.open("POST","https://events.apester.com/event",!0),xmlHttp.setRequestHeader("Content-Type","application/json;charset=UTF-8"),xmlHttp.send(JSON.stringify({event:"apester-sdk-crashed",properties:{destinationUri:document.location.href},metadata:{}})),console.error("ApesterSDK had critical error, please contact us with the following error message: ",e)}